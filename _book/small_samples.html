<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Artifact Corrections for Effect Sizes - 4&nbsp; Small Samples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./unreliability.html" rel="next">
<link href="./intro.html" rel="prev">
<link href="./figure/favicon_book.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="Artifact Corrections for Effect Sizes - 4&nbsp; Small Samples">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://matthewbjane.quarto.pub/artifact-corrections-for-effect-sizes/figure/MJB_twitter.jpg">
<meta name="twitter:creator" content="@MatthewBJane">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./small_samples.html">Artifact Corrections</a></li><li class="breadcrumb-item"><a href="./small_samples.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Small Samples</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Artifact Corrections for Effect Sizes</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MatthewBJane/artifact-corrections-for-effect-sizes/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Artifact-Corrections-for-Effect-Sizes.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Greetings</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dedication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Dedication</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Effect Sizes and Artifacts</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Artifact Corrections</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./small_samples.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Small Samples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unreliability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Unreliability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misclassification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Group Misclassification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./artificial_dichotomization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Artificial Dichotomization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scale_coarseness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Scale Coarseness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./direct_range_restriction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Direct Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./indirect_range_restriction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Indirect Selection</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Application to Meta-Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metaanalysis_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introduction to Meta-Analysis Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./artifact_correction_metaanalysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Artifact Correction Meta-Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Conclusion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references_page.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">4.1</span> Introduction</a></li>
  <li><a href="#when-correcting-alongside-other-artifacts" id="toc-when-correcting-alongside-other-artifacts" class="nav-link" data-scroll-target="#when-correcting-alongside-other-artifacts"><span class="header-section-number">4.2</span> When Correcting alongside other Artifacts</a></li>
  <li><a href="#correcting-standardized-mean-differences-for-small-sample-bias" id="toc-correcting-standardized-mean-differences-for-small-sample-bias" class="nav-link" data-scroll-target="#correcting-standardized-mean-differences-for-small-sample-bias"><span class="header-section-number">4.3</span> Correcting Standardized Mean Differences for Small Sample Bias</a>
  <ul class="collapse">
  <li><a href="#defining-the-target-quantity" id="toc-defining-the-target-quantity" class="nav-link" data-scroll-target="#defining-the-target-quantity"><span class="header-section-number">4.3.1</span> Defining the Target Quantity</a></li>
  <li><a href="#artifact-correction-for-d" id="toc-artifact-correction-for-d" class="nav-link" data-scroll-target="#artifact-correction-for-d"><span class="header-section-number">4.3.2</span> Artifact Correction for <em>d</em></a></li>
  </ul></li>
  <li><a href="#correcting-for-small-sample-bias-in-correlations" id="toc-correcting-for-small-sample-bias-in-correlations" class="nav-link" data-scroll-target="#correcting-for-small-sample-bias-in-correlations"><span class="header-section-number">4.4</span> Correcting for Small Sample Bias in Correlations</a>
  <ul class="collapse">
  <li><a href="#defining-the-estimand" id="toc-defining-the-estimand" class="nav-link" data-scroll-target="#defining-the-estimand"><span class="header-section-number">4.4.1</span> Defining the Estimand</a></li>
  <li><a href="#artifact-correction-for-r" id="toc-artifact-correction-for-r" class="nav-link" data-scroll-target="#artifact-correction-for-r"><span class="header-section-number">4.4.2</span> Artifact Correction for <em>r</em></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Small Samples</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">4.1</span> Introduction</h2>
<p>The purpose of sample statistics is to draw meaningful inferences about the population. However, effect size estimators such as Pearson’s correlation coefficient and Cohen’s <span class="math inline">\(d\)</span> are biased in small sample sizes. This small sample bias is an artifact and can be adjusted with the appropriate correction factor.</p>
</section>
<section id="when-correcting-alongside-other-artifacts" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="when-correcting-alongside-other-artifacts"><span class="header-section-number">4.2</span> When Correcting alongside other Artifacts</h2>
<p>The small sample bias should always be corrected for prior to applying any other artifact correction. It is independent of all other artifact corrections and therefore the corrected effect sizes in this section can be treated as the uncorrected effect sizes in other sections.</p>
</section>
<section id="correcting-standardized-mean-differences-for-small-sample-bias" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="correcting-standardized-mean-differences-for-small-sample-bias"><span class="header-section-number">4.3</span> Correcting Standardized Mean Differences for Small Sample Bias</h2>
<section id="defining-the-target-quantity" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="defining-the-target-quantity"><span class="header-section-number">4.3.1</span> Defining the Target Quantity</h3>
<p>Our quantity of interest is the population standardized mean difference, <span class="math inline">\(\delta\)</span>, between groups <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. We can model the relationship between the population standardized mean difference and the estimate (<span class="math inline">\(d\)</span>),</p>
<p><span class="math display">\[
d = a\delta+e.
\]</span></p>
<p>Where <span class="math inline">\(a\)</span> is an attenuation/inflation factor and <span class="math inline">\(e\)</span> is our sampling error term. Ultimately, we can obtain an unbiased estimate of the population standardized mean difference by correcting the sample standardized mean difference as follows,</p>
<p><span class="math display">\[
d_c = \frac{d}{\hat{a}}.
\]</span></p>
</section>
<section id="artifact-correction-for-d" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="artifact-correction-for-d"><span class="header-section-number">4.3.2</span> Artifact Correction for <em>d</em></h3>
<p>As the sample size approaches infinity, Cohen’s estimator of the standardized mean difference is unbiased <span class="citation" data-cites="hedges1981 cohen1977">(<a href="references_page.html#ref-hedges1981" role="doc-biblioref">Hedges 1981</a>; <a href="references_page.html#ref-cohen1977" role="doc-biblioref">Cohen 2013</a>)</span>. However, in small sample sizes Cohen’s estimator is inflated, that is, on average, it overestimates the population standardized mean difference. To see why this is the case, we can first define the population standardized mean difference between group <span class="math inline">\(A\)</span> and group <span class="math inline">\(B\)</span> such that,</p>
<p><span class="math display">\[
\delta = \frac{\mu_A-\mu_B}{\sigma}.
\]</span></p>
<p>Where <span class="math inline">\(\bar{y}_A\)</span> and <span class="math inline">\(\bar{y}_B\)</span> are the observed arithmetic means of group <span class="math inline">\(A\)</span> and group <span class="math inline">\(B\)</span>, respectively. A sample estimate of the standardized mean difference is,</p>
<p><span id="eq-d"><span class="math display">\[
d = \frac{\overline{Y}_A-\overline{Y}_B}{S_p}
\tag{4.1}\]</span></span></p>
<p>Where <span class="math inline">\(S_p\)</span> is the pooled standard deviation (i.e., weighted average within-group standard deviation). The estimator, <span class="math inline">\(d\)</span>, is an asymptotically unbiased estimate of <span class="math inline">\(\delta\)</span>. We can denote this asymptotic relationship as,</p>
<p><span class="math display">\[
\mathbb{E}_i[d_i] \overset{_n}{\asymp} \delta.
\]</span></p>
<p>However, <span class="math inline">\(d\)</span> is a biased estimator of <span class="math inline">\(\delta\)</span> when the sample size is finite. Particularly, the smaller the sample size, the larger the bias. We can see that in <a href="#fig-d-bias">Figure&nbsp;<span>4.1</span></a>, <span class="math inline">\(d\)</span> tends to over-estimate <span class="math inline">\(\delta\)</span>. Therefore, we can apply an artifact inflation factor, <span class="math inline">\(a\)</span>, to capture this over-estimation,</p>
<p><span class="math display">\[
\mathbb{E}_i[d_i] = a\delta.
\]</span></p>
<p>The reason for this bias in <span class="math inline">\(d\)</span> values is two-fold:</p>
<ul>
<li>Standard deviations tend to be attenuated in small sample sizes. This is due to the fact that although variance (squared standard deviation) is an unbiased estimator of the population variance, the square root of the variance (i.e., the standard deviation, <span class="math inline">\(S_p\)</span>) is a biased estimate of the population standard deviation <span class="citation" data-cites="holtzman1950">(<span class="math inline">\(\mathbb{E}_i[\sqrt{S_{p_i}}] \neq \sqrt{\sigma}\)</span>, <a href="references_page.html#ref-holtzman1950" role="doc-biblioref">Holtzman 1950</a>)</span>.</li>
<li>A ratio is biased in small sample sizes <span class="citation" data-cites="vankempen2000">(<a href="references_page.html#ref-vankempen2000" role="doc-biblioref">Kempen and Vliet 2000</a>)</span>, therefore the ratio between the mean difference and the standard deviation (see <a href="#eq-d">Equation&nbsp;<span>4.1</span></a>) will likewise be biased.</li>
</ul>
<p>To obtain an unbiased estimate of the population standardized mean difference, we need to first estimate the artifact inflation factor, <span class="math inline">\(a\)</span>. In this case, the artifact inflation factor has been mathematically derived previously by <span class="citation" data-cites="hedges1989">Hedges (<a href="references_page.html#ref-hedges1989" role="doc-biblioref">1989</a>)</span>. For other types of artifacts, <span class="math inline">\(a\)</span> is unknown in practice and must be estimated, however, for small sample bias the exact value of <span class="math inline">\(a\)</span> is known. The precise value of <span class="math inline">\(a\)</span> is a function of sample size <span class="citation" data-cites="hedges1989">(equation 6e, <a href="references_page.html#ref-hedges1989" role="doc-biblioref">Hedges 1989</a>)</span>,</p>
<p><span class="math display">\[
a = \frac{\Gamma\left(\frac{n-3}{2}\right)\sqrt{\frac{n-2}{2}}}{\Gamma\left(\frac{n-2}{2}\right)}.
\]</span> Where <span class="math inline">\(\Gamma(\cdot)\)</span> denotes the gamma function. The gamma function is factorial function generalized to non-integers <span class="citation" data-cites="marco2021">(note that a factorial function on integers would look something like: <span class="math inline">\(3! = 3 \cdot 2 \cdot 1\)</span>, <a href="references_page.html#ref-marco2021" role="doc-biblioref">Taboga 2021</a>)</span>. There is also an approximation of <span class="math inline">\(a\)</span> that is more computationally trivial <span class="citation" data-cites="hedges1989">(re-arrangement of the first formula on pp.&nbsp;114, <a href="references_page.html#ref-hedges1989" role="doc-biblioref">Hedges 1989</a>)</span>:</p>
<p><span class="math display">\[
a \approx \frac{4n-9}{4n-12}
\]</span></p>
<p>However, with the advent of computers, this approximation formula is unnecessary. We can see in <a href="#fig-r-bias">Figure&nbsp;<span>4.2</span></a> that there is notable bias when sample size is below 20. Furthermore, the bias is most pronounced when the sample <span class="math inline">\(d\)</span> value is larger (there is no bias at <span class="math inline">\(d=0\)</span>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-d-bias" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="small_samples_files/figure-html/fig-d-bias-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.1: Plot showing the bias in the standardized mean difference computed in small samples. The X-axis is the sample size (<span class="math inline">\(n\)</span>, the vertical bars are indicative of each integer). The Y-axis is the the estimated standardized mean difference (<span class="math inline">\(d\)</span>). The dark pink coloring indicates more bias.</figcaption>
</figure>
</div>
</div>
</div>
<p>Using <span class="math inline">\(a\)</span>, we can correct the <span class="math inline">\(d\)</span> value such that,</p>
<p><span id="eq-d-corr"><span class="math display">\[
d_c = \frac{d}{a} = \frac{d}{ \left[\frac{\Gamma\left(\frac{n-3}{2}\right)\sqrt{\frac{n-2}{2}}}{\Gamma\left(\frac{n-2}{2}\right)}\right]}.
\tag{4.2}\]</span></span></p>
<p>To obtain the standard error of <span class="math inline">\(d_c\)</span> we can apply the same correction as above to the standard error of <span class="math inline">\(d\)</span> (<span class="math inline">\(se\)</span>),</p>
<p><span id="eq-se-corr-d"><span class="math display">\[
se(d_c) = \frac{se(d)}{a} = \frac{se(d)}{ \left[\frac{\Gamma\left(\frac{n-3}{2}\right)\sqrt{\frac{n-2}{2}}}{\Gamma\left(\frac{n-2}{2}\right)}\right]}.
\tag{4.3}\]</span></span></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Applied Example in R
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s say we want to compute the mean difference of test scores between two classes. Class 1 has 11 students and class 2 has 10 students. We then obtain a standardized mean difference between the two classes of <span class="math inline">\(d=.43\)</span>. In R, we can use the <code>correct_d_bias()</code> function to correct the point estimate (using <a href="#eq-d-corr">Equation&nbsp;<span>4.2</span></a>) and then <code>var_error_g</code> function to correct the error variance and thus the standard error (using <a href="#eq-se-corr-d">Equation&nbsp;<span>4.3</span></a>). Both of these functions are found in the <code>psychmeta</code> package <span class="citation" data-cites="dahlke2019">(<a href="references_page.html#ref-dahlke2019" role="doc-biblioref">Dahlke and Wiernik 2019</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psychmeta)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> .<span class="dv">43</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># correct</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>dc <span class="ot">&lt;-</span> <span class="fu">correct_d_bias</span>(<span class="at">d =</span> d,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n =</span> n1<span class="sc">+</span>n2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>var_corrected <span class="ot">&lt;-</span> <span class="fu">var_error_g</span>(<span class="at">g =</span> dc, </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">n1 =</span> n1, </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">n2 =</span> n2)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">dc=</span>dc, <span class="at">se =</span> <span class="fu">sqrt</span>(var_corrected))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            dc       se
[1,] 0.4144264 0.424262</code></pre>
</div>
</div>
<p>The output shows a corrected standardized mean difference of <span class="math inline">\(d_c = 0.41\)</span> (<span class="math inline">\(se(d_c) = 0.42\)</span>)</p>
</div>
</div>
</section>
</section>
<section id="correcting-for-small-sample-bias-in-correlations" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="correcting-for-small-sample-bias-in-correlations"><span class="header-section-number">4.4</span> Correcting for Small Sample Bias in Correlations</h2>
<section id="defining-the-estimand" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="defining-the-estimand"><span class="header-section-number">4.4.1</span> Defining the Estimand</h3>
<p>Our quantity of interest is the population correlation, <span class="math inline">\(\rho\)</span>. We can model the relationship between the population correlation and our sample estimate (<span class="math inline">\(r\)</span>) with,</p>
<p><span class="math display">\[
r = a\rho+e
\]</span></p>
<p>Where <span class="math inline">\(a\)</span> is our small sample biasing factor and <span class="math inline">\(e\)</span> is our sampling error term. Ultimately, we can obtain an unbiased estimate of the population correlation by correcting the observed correlation as follows,</p>
<p><span class="math display">\[
r_c = \frac{r}{a}
\]</span></p>
</section>
<section id="artifact-correction-for-r" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="artifact-correction-for-r"><span class="header-section-number">4.4.2</span> Artifact Correction for <em>r</em></h3>
<p>Let’s first define the correlation in the population as the covariance between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> (<span class="math inline">\(\sigma_{XY}\)</span>) standardized by the product of the standard deviation of <span class="math inline">\(X\)</span> (<span class="math inline">\(\sigma_X\)</span>) and <span class="math inline">\(Y\)</span> (<span class="math inline">\(\sigma_Y\)</span>):</p>
<p><span class="math display">\[
\rho = \frac{\sigma_{XY}}{\sigma_{X}\sigma_Y}
\]</span></p>
<p>The sample estimate can be defined as (<span class="math inline">\(S\)</span> denoting the sample estimates of <span class="math inline">\(\sigma\)</span>),</p>
<p><span class="math display">\[
r = \frac{S_{XY}}{S_{X}S_Y}
\]</span></p>
<p>Asymptotically, the expectation of a sample correlation is equal to the population correlation,</p>
<p><span class="math display">\[
\mathbb{E}_i[r_i] \overset{_n}{\asymp} \rho.
\]</span></p>
<p>However, similar to standardized mean differences, correlations are also biased in small sample sizes <span class="citation" data-cites="olkin1958">(<a href="references_page.html#ref-olkin1958" role="doc-biblioref">Olkin and Pratt 1958</a>)</span>. Unlike standardized mean differences, Pearson correlations are <em>under</em>-estimated, rather than over-estimated. Therefore, an artifact <em>attenuation</em> factor, <span class="math inline">\(a\)</span>, can account for this bias,</p>
<p><span class="math display">\[
\mathbb{E}_i[r_i] = a\rho.
\]</span></p>
<p>Because the attenuation factor, <span class="math inline">\(a\)</span>, has been mathematically derived directly Olkin and Pratt <span class="citation" data-cites="olkin1958">(equation 2.3, <a href="references_page.html#ref-olkin1958" role="doc-biblioref">1958</a>)</span>, there is no need to obtain a noisy estimate of <span class="math inline">\(a\)</span>. Therefore <span class="math inline">\(a\)</span> can be defined exactly as,</p>
<p><span id="eq-a-r"><span class="math display">\[
a = \frac{1}{F\left(\frac{1}{2},\frac{1}{2};\frac{n-1}{2};1-r^2\right)}
\tag{4.4}\]</span></span></p>
<p>Where <span class="math inline">\(F(\cdot)\)</span> is the hypergeometric function (for background see the Wikipedia page: ). The hypergeometric function is a complicated and iterative function which which can be defined in terms of <span class="math inline">\(\Gamma(\cdot)\)</span> functions <span class="citation" data-cites="olkin1958">(plugging in values into equation 2.2, <a href="references_page.html#ref-olkin1958" role="doc-biblioref">Olkin and Pratt 1958</a>)</span></p>
<p><span class="math display">\[
F\left(\frac{1}{2},\frac{1}{2};\frac{n-1}{2};1-r^2\right) = \sum^{\infty}_{z=0} \frac{\Gamma\left(\frac{1}{2} + z\right)\Gamma\left(\frac{n-1}{2}\right)\left(1-r^2\right)^z}{\Gamma\left(\frac{1}{2}\right)\Gamma\left(\frac{n-1}{2}+z\right)z!}
\]</span></p>
<p>Although this formula is complex, it can be easily done in R so do not worry! There is also an approximation of <span class="math inline">\(a\)</span> that is much simpler than <a href="#eq-a-r">Equation&nbsp;<span>4.4</span></a>,</p>
<p><span class="math display">\[
a \approx \frac{2(n-3)}{2n-r^2-5}
\]</span></p>
<p>Then we can correct the point-estimate the sampling variance for small sample bias. I will emphasize that approximations are not necessary if a computer is available. We can see in <a href="#fig-r-bias">Figure&nbsp;<span>4.2</span></a> that there is notable bias when sample size is below 15. Furthermore, the bias is most pronounced when the sample correlation around .60 (there is no bias at <span class="math inline">\(r=0\)</span> and <span class="math inline">\(r=\pm 1\)</span>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-r-bias" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="small_samples_files/figure-html/fig-r-bias-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.2: Plot showing the bias in the correlations computed in small samples. The X-axis is the sample size (<span class="math inline">\(n\)</span>, the vertical bars are indicative of each integer). The Y-axis is the the estimated Pearson correlation (<span class="math inline">\(r\)</span>). The dark pink coloring indicates more bias.</figcaption>
</figure>
</div>
</div>
</div>
<p>To correct for small sample bias, we can divide the sample correlation <span class="math inline">\(r\)</span> by the attenuation factor <span class="math inline">\(a\)</span>,</p>
<p><span id="eq-r-corr"><span class="math display">\[
r_c = \frac{r}{a} = \frac{r}{\left[\frac{1}{F\left(\frac{1}{2},\frac{1}{2};\frac{n-1}{2};1-r^2\right)}\right]}
\tag{4.5}\]</span></span></p>
<p>Where the standard error of <span class="math inline">\(r_c\)</span> can be obtained by correcting the observed standard error (<span class="math inline">\(se\)</span>),</p>
<p><span id="eq-se-corr"><span class="math display">\[
se(r_c) = \frac{se(r)}{a} = \frac{se(r)}{\left[\frac{1}{F\left(\frac{1}{2},\frac{1}{2};\frac{n-1}{2};1-r^2\right)}\right]}
\tag{4.6}\]</span></span></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Applied Example in R
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s say we compute a correlation of <span class="math inline">\(r=.43\)</span> between test scores and self-reported motivation in a small sample of students. In R, we can use the <code>escalc</code> function in the <code>metafor</code> package <span class="citation" data-cites="viechtbauer2010">(<a href="references_page.html#ref-viechtbauer2010" role="doc-biblioref">Viechtbauer 2010</a>)</span>. Setting <code>measure = "UCOR"</code> will apply the small sample correction for the point estimate (<a href="#eq-r-corr">Equation&nbsp;<span>4.5</span></a>) and the error variance (i.e., square of the standard error, <a href="#eq-se-corr">Equation&nbsp;<span>4.6</span></a>). Note in order to run this function you must have the <code>gsl</code> package already installed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('gsl')</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metafor)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> .<span class="dv">43</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># correct the correlation</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">escalc</span>(<span class="at">measure =</span> <span class="st">'UCOR'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">ri =</span> r,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">ni =</span> n,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"rc"</span>, <span class="st">"se.2"</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     rc  se.2 
1 0.454 0.063 </code></pre>
</div>
</div>
<p>The output shows a corrected correlation between test scores and motivation of <span class="math inline">\(r_c=.454\)</span> (<span class="math inline">\(se(r)^2=.063\)</span>).</p>
</div>
</div>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="matthewbjane" data-description="Support me on Buy me a coffee!" data-message="Thank you for being here! Consider buying me a coffee!" data-color="#eeb4d7ff" data-position="Right" data-x_margin="18" data-y_margin="18"></script>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-cohen1977" class="csl-entry" role="listitem">
Cohen, Jacob. 2013. <em>Statistical Power Analysis for the Behavioral Sciences</em>. Academic Press.
</div>
<div id="ref-dahlke2019" class="csl-entry" role="listitem">
Dahlke, Jeffrey A., and Brenton M. Wiernik. 2019. <span>“Psychmeta: An R Package for Psychometric Meta-Analysis.”</span> <em>Applied Psychological Measurement</em> 43 (5): 415–16. <a href="https://doi.org/10.1177/0146621618795933">https://doi.org/10.1177/0146621618795933</a>.
</div>
<div id="ref-hedges1981" class="csl-entry" role="listitem">
Hedges, Larry V. 1981. <span>“Distribution Theory for Glass’s Estimator of Effect Size and Related Estimators.”</span> <em>Journal of Educational Statistics</em> 6 (2): 107–28. <a href="https://doi.org/10.3102/10769986006002107">https://doi.org/10.3102/10769986006002107</a>.
</div>
<div id="ref-hedges1989" class="csl-entry" role="listitem">
———. 1989. <span>“An Unbiased Correction for Sampling Error in Validity Generalization Studies.”</span> <em>Journal of Applied Psychology</em> 74 (3): 469–77. <a href="https://doi.org/10.1037/0021-9010.74.3.469">https://doi.org/10.1037/0021-9010.74.3.469</a>.
</div>
<div id="ref-holtzman1950" class="csl-entry" role="listitem">
Holtzman, Wayne H. 1950. <span>“The Unbiased Estimate of the Population Variance and Standard Deviation.”</span> <em>The American Journal of Psychology</em> 63 (4): 615–17. <a href="https://doi.org/10.2307/1418879">https://doi.org/10.2307/1418879</a>.
</div>
<div id="ref-vankempen2000" class="csl-entry" role="listitem">
Kempen, G.m.p. van, and L.j. van Vliet. 2000. <span>“Mean and Variance of Ratio Estimators Used in Fluorescence Ratio Imaging.”</span> <em>Cytometry</em> 39 (4): 300–305. <a href="https://doi.org/10.1002/(SICI)1097-0320(20000401)39:4<300::AID-CYTO8>3.0.CO;2-O">https://doi.org/10.1002/(SICI)1097-0320(20000401)39:4&lt;300::AID-CYTO8&gt;3.0.CO;2-O</a>.
</div>
<div id="ref-olkin1958" class="csl-entry" role="listitem">
Olkin, Ingram, and John W. Pratt. 1958. <span>“Unbiased Estimation of Certain Correlation Coefficients.”</span> <em>The Annals of Mathematical Statistics</em> 29 (1): 201–11. <a href="https://www.jstor.org/stable/2237306">https://www.jstor.org/stable/2237306</a>.
</div>
<div id="ref-marco2021" class="csl-entry" role="listitem">
Taboga, Marco. 2021. <span>“Gamma Function.”</span> <a href="https://www.statlect.com/mathematical-tools/gamma-function" class="uri">https://www.statlect.com/mathematical-tools/gamma-function</a>.
</div>
<div id="ref-viechtbauer2010" class="csl-entry" role="listitem">
Viechtbauer, Wolfgang. 2010. <span>“Conducting meta-analyses in R with the metafor package.”</span> <em>Journal of Statistical Software</em> 36 (3): 1–48. <a href="https://doi.org/10.18637/jss.v036.i03">https://doi.org/10.18637/jss.v036.i03</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Effect Sizes and Artifacts</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./unreliability.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Unreliability</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>