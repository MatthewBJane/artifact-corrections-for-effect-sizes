<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>unreliability</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="unreliability.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="unreliability" class="level1">
<h1>Unreliability</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In general terms, measurement is the process of quantifying an attribute or characteristic of something. In scientific measurement, the measurand is the quantity of the attribute we intend to measure. In the psychological sciences, measurands usually take the form of constructs such as intelligence or anxiety. The goal of measurement is to produce quantities (i.e., scores) that accurately reflect the measurand. It is important to note that measures are not all created equal, some perform better than others. Ideally, measures should produce scores that are consistent and repeatable, this is referred to as the <em>reliability</em> of a measure. A high quality measure should produce highly reliable scores. This section will review what reliability is in theory, how to estimate reliability, and how to adjust effect sizes for measurement error.</p>
</section>
<section id="reliability-in-true-score-theory" class="level2">
<h2 class="anchored" data-anchor-id="reliability-in-true-score-theory">Reliability in True Score Theory</h2>
<p>True score theory (or classical test theory) is a mathematical formalization of scores obtained from measurements. The true score model assumes that each individual has a true score, <span class="math inline">\(t\)</span>, that stays constant over measurements. Observed scores, <span class="math inline">\(x_m\)</span>, can vary between measurements, <span class="math inline">\(m\)</span>. This variation is due to measurement-specific error, <span class="math inline">\(e_m\)</span>.</p>
<p><span class="math display">\[
x_{m} = t+e_{m}
\]</span></p>
<p>The true score can be defined as the expected value (i.e., the mean) of observed scores over an infinite number of repeated measurements such that, <span class="math inline">\(t=\mathbb{E}_{m\rightarrow\infty}[x_{m}]\)</span>. Therefore, it is also assumed that the expectation of measurement-specific error is zero, <span class="math inline">\(\mathbb{E}_{m\rightarrow\infty}[e_{m}]=0\)</span>. It follows from these assumptions that the covariance between errors and true scores is zero (<span class="math inline">\(\sigma_{et}=0\)</span>) and the covariance between error scores in parallel measurements is zero (<span class="math inline">\(\sigma_{e e'}=0\)</span>). The independence between true scores and errors provide convenient parsing of the variance in observed scores (<span class="math inline">\(\sigma^2_{x_m}\)</span>) into components of variance in true scores (<span class="math inline">\(\sigma_t^2\)</span>) and errors (<span class="math inline">\(\sigma_{e_m}^2\)</span>),</p>
<p><span class="math display">\[
\sigma_{x_m}^2 = \sigma_t^2 + \sigma_{e_m}^2
\]</span> If <span class="math inline">\(\sigma_{e_m}^2 &gt; 0\)</span> then the measurement has imperfect reliability, that is, observed scores are not identical to true scores. In practice, this is almost always the case. Reliability can be defined as the square correlation between observed scores and true scores, <span class="math inline">\(r_{xt}^2\)</span>, or the correlation between observed scores in parallel measurements, <span class="math inline">\(r_{xx'}=r_{xt}^2\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figure/unreliability_diagram_1.png" class="img-fluid figure-img" width="400"></p>
<figcaption class="figure-caption">Structural model illustrating the relationship between true scores, observed scores, and error scores. The pink circle labeled <span class="math inline">\(t\)</span> indicates the true scores, the blue squares labeled with <span class="math inline">\(x\)</span> and <span class="math inline">\(x'\)</span> represent observed scores on parallel measurements, and the red <span class="math inline">\(e\)</span> denotes error. Correlations between <span class="math inline">\(t\)</span>, <span class="math inline">\(x\)</span>, and <span class="math inline">\(x'\)</span> are in terms of reliability (<span class="math inline">\(r_{xx'}\)</span>). Note that <span class="math inline">\(\sqrt{r_{xx'}}=r_{xt}\)</span>.</figcaption>
</figure>
</div>
<p>Given that errors do not co-vary between parallel measurements and true scores are held constant over measurements, it becomes apparent that the covariance between observed scores produced from parallel measurements must solely be attributable to true score variance, <span class="math inline">\(\sigma_{xx'}=\sigma_t^2\)</span>. The covariance in observed scores can be standardized to obtain the correlation coefficient between parallel measurements (i.e., the reliability), such that, <span class="math inline">\(r_{xx'}=\sigma_{xx'}/\sigma_x\sigma_{x'} = \sigma_t /\sigma^2_{x_m}\)</span>. Therefore reliability can be expressed in a few forms different forms</p>
<p><span class="math display">\[
r_{xx'} =r^2_{xt} = \frac{\sigma_t^2}{\sigma_t^2+\sigma_{e_m}^2} = \frac{\sigma_t^2}{\sigma_{x_m}^2}
\]</span></p>
<p>In the literature, the correlation between observed and true scores, <span class="math inline">\(r_{xt}\)</span>, is often referred to as the “measure quality index” <span class="citation" data-cites="hunter1990a">(<a href="#ref-hunter1990a" role="doc-biblioref">Hunter and Schmidt 1990</a>)</span>, however measure quality encompasses both reliability <em>and</em> validity. A measure can demonstrate high reliability even though the scores produced by the measure do not accurately reflect the measurand (the quantity that we are intending to measure). For example, if an individual were to step on a weight scale with shoes on, the weight presented on the scale would be highly reliable, namely, if the individual were to repeat this process, they would achieve highly similar results. Nevertheless, the observed weight is systematically biased upward by the weight of the shoes. Therefore if a measure is reliable it does not logically follow that the measure is necessarily valid.</p>
</section>
<section id="estimating-reliability" class="level2">
<h2 class="anchored" data-anchor-id="estimating-reliability">Estimating Reliability</h2>
<p>In practice, reliability must be estimated through indirect methods, since true scores and errors are unknown. Their are many estimators that can be used however, we will go over three of the most common approaches: coefficient alpha, split-half, and test-retest reliability.</p>
<section id="internal-consistency-estimators" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="internal-consistency-estimators">Internal Consistency Estimators</h3>
<p>Maybe the most conventionally reported reliability estimator in the psychological sciences is coefficient alpha, also referred to as Cronbach’s alpha or internal consistency. Alpha has the benefit of being computationally convenient, but it also brings along many assumptions that are often violated in practice <span class="citation" data-cites="haertel2006 sijtsma2009">(<a href="#ref-haertel2006" role="doc-biblioref">Haertel 2006</a>; <a href="#ref-sijtsma2009" role="doc-biblioref">Sijtsma 2009</a>)</span>. A common strategy in the social sciences is to take <span class="math inline">\(k\)</span> noisy measurements of some construct (e.g., likert responses in a psychological scale) and combine them to create a more stable composite score (<span class="math inline">\(x_C\)</span>) that better estimates the individlatrue score, <span class="math display">\[
x_c = x_1 + x_2 +...+x_k= \sum^k_{m=1}x_m
\]</span>Coefficient alpha is represents the reliability of this composite. Coefficient alpha only requires three parameters to calculate, the number of measurements (<span class="math inline">\(k\)</span>), the variances of each items ( <span class="math inline">\(\sigma^2_{x_m}\)</span>), and the variance of the composite score (<span class="math inline">\(\sigma^2_{x_c}\)</span>),</p>
<p><span class="math display">\[
r_{x_c x_c',\alpha} = \frac{k}{k-1}\left( 1 - \frac{\sum_{m=1}^k \sigma^2_{x_m}}{\sigma^2_{x_c}} \right)
\]</span></p>
<p>With tighter assumptions [i.e., strictly parallel forms; <span class="citation" data-cites="haertel2006">Haertel (<a href="#ref-haertel2006" role="doc-biblioref">2006</a>)</span>], the formula for coefficient alpha can be simplified to just two parameters: the number of measurements and the average correlation between measured scores (<span class="math inline">\(\bar{r}_{x_i x_j}\)</span>, where <span class="math inline">\(i\neq j\)</span>). This formula is known as Spearman-Brown’s prophecy,</p>
<p><span class="math display">\[
r_{x_cx_c',\text{SB}}= \frac{k \bar{r}_{x_i x_j}}{1+(k-1)\bar{r}_{x_i x_j}}
\]</span></p>
<p>This can be simplified further if we only have two parallel measurements. This formulation is traditionally called split-half reliability:</p>
<p><span class="math display">\[
r_{x_cx_c',\text{SH}}= \frac{2r_{x_1 x_2}}{1+r_{x_1 x_2}}
\]</span></p>
<p>All of these reliability estimators measure internal consistency, therefore they do not account for error outside of the measurement-specific error. There are other sources of error that internal consistency reliability estimates do not account for, such as transient error or rater-specific error.</p>
</section>
<section id="calculating-internal-consistency-in-r-and-python" class="level3">
<h3 class="anchored" data-anchor-id="calculating-internal-consistency-in-r-and-python">Calculating Internal Consistency in R and Python</h3>
<div class="tabset-margin-container"></div><div id="estimating-reliability-code" class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div id="estimating-reliability-code" class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><strong>Simulate Data:</strong> Let us simulate a data set of 50 individuals where each observed score has the same true score with some error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">343</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># simulate 50 true scores</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> t <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># simulate observed scores for measurement 1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> t <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># simulate observed scores for measurement 2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">=</span> t <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># simulate observed scores for measurement 3</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>x4 <span class="ot">=</span> t <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># simulate observed scores for measurement 4</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>xc <span class="ot">=</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="co"># sum observed scores to create composite score </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Calculate Coefficient Alpha Reliability:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. calculate variance of observed (measured) scores</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>var_xm <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">var</span>(x1),<span class="fu">var</span>(x2),<span class="fu">var</span>(x3),<span class="fu">var</span>(x4))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. calculate variance of composite score</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>var_xc <span class="ot">=</span> <span class="fu">var</span>(xc)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. get number of items (k)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="fu">length</span>(var_xm)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># step 4. calculate coefficient alpha reliability</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>rel_alpha <span class="ot">=</span> k <span class="sc">/</span> (k<span class="dv">-1</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>(var_xm)<span class="sc">/</span>var_xc)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(rel_alpha,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.775</code></pre>
</div>
</div>
<p><strong>Calculate Reliability via Spearman-Brown’s Prophecy:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. get correlation matrix between all observed scores</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>corr_mat <span class="ot">=</span> <span class="fu">cor</span>(<span class="fu">cbind</span>(x1,x2,x3,x4))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. average off-diagonal elements of matrix</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(corr_mat) <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>rxixj <span class="ot">=</span> <span class="fu">mean</span>(corr_mat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. get number of items (k)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="fu">dim</span>(corr_mat)[<span class="dv">1</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># step 4. calculate Spearman-Brown reliability</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>rel_SB <span class="ot">=</span> k <span class="sc">*</span> rxixj <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> (k<span class="dv">-1</span>) <span class="sc">*</span> rxixj)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(rel_SB,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.775</code></pre>
</div>
</div>
<p><strong>Calculate the Split-Half Reliability:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. make composite scores for each half of the observed scores</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>xc1 <span class="ot">=</span> x1 <span class="sc">+</span> x2</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>xc2 <span class="ot">=</span> x3 <span class="sc">+</span> x4</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. calculate the correlation between the scores of both halves</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>rx1x2 <span class="ot">=</span> <span class="fu">cor</span>(xc1,xc2)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. calculate the split-half reliability</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>rel_SH <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>rx1x2 <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rx1x2)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(rel_SH,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.824</code></pre>
</div>
</div>
<p><strong>True Reliability:</strong> Lets see how the results compare to the squared correlation of the true scores and our composite score (true reliability).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rxt <span class="ot">=</span> <span class="fu">cor</span>(xc,t)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(rxt<span class="sc">^</span><span class="dv">2</span>,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.753</code></pre>
</div>
</div>
<p>In this case, the reliability estimates do a fairly good job of estimating the true reliability of the observed scores.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><strong>Simulate Data:</strong> Let us simulate a data set of 50 individuals where each observed score has the same true score with some error. To calculate the necessary statistics, we will import the <code>numpy</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">343</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">50</span>) <span class="co"># simulate 50 true scores</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> t <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">50</span>) <span class="co"># simulate observed scores for measurement 1</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> t <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">50</span>) <span class="co"># simulate observed scores for measurement 2</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>x3 <span class="op">=</span> t <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">50</span>) <span class="co"># simulate observed scores for measurement 3</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>x4 <span class="op">=</span> t <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">50</span>) <span class="co"># simulate observed scores for measurement 4</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>xc <span class="op">=</span> x1 <span class="op">+</span> x2 <span class="op">+</span> x3 <span class="op">+</span> x4 <span class="co"># sum observed scores to create composite score </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Calculate Coefficient Alpha Reliability:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. calculate variance of observed (measured) scores</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>var_xm <span class="op">=</span> [np.var(x1),np.var(x2),np.var(x3),np.var(x4)]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. calculate variance of composite score</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>var_xc <span class="op">=</span> np.var(xc)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. get number of items (k)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="bu">len</span>(var_xm)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># step 4. calculate coefficient alpha reliability</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>rel_alpha <span class="op">=</span> k <span class="op">/</span> (k<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> <span class="bu">sum</span>(var_xm)<span class="op">/</span>var_xc)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">round</span>(rel_alpha,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.769</code></pre>
</div>
</div>
<p><strong>Calculate Reliability fromSpearman-Brown’s prophecy formula:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. get correlation matrix between all observed scores</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>corr_mat <span class="op">=</span> np.corrcoef([x1,x2,x3,x4])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. average off-diagonal elements of matrix</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>rxixj <span class="op">=</span> np.mean(corr_mat[<span class="op">~</span>np.eye(k,dtype<span class="op">=</span><span class="bu">bool</span>)])</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. get number of items (k)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="bu">len</span>(corr_mat)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># step 4. calculate Spearman-Brown reliability</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>rel_SB <span class="op">=</span> k <span class="op">*</span> rxixj <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> (k<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> rxixj)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">round</span>(rel_SB,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.772</code></pre>
</div>
</div>
<p><strong>Calculate Split-Half Reliability:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># step 1. make composite scores for each half of the observed scores</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>xc1 <span class="op">=</span> x1 <span class="op">+</span> x2</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>xc2 <span class="op">=</span> x3 <span class="op">+</span> x4</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># step 2. calculate the correlation between the scores of both halves</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>rx1x2 <span class="op">=</span> np.corrcoef(xc1,xc2)[<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># step 3. calculate the split-half reliability</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>rel_SH <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>rx1x2 <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> rx1x2)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">round</span>(rel_SH,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.772</code></pre>
</div>
</div>
<p><strong>True Reliability:</strong> Lets see how the results compare to the squared correlation of the true scores and our composite score (true reliability).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display values</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>rxt <span class="op">=</span> np.corrcoef(xc,t)[<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">round</span>(rxt<span class="op">**</span><span class="dv">2</span>,<span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.791</code></pre>
</div>
</div>
<p>In this case, the reliability estimates do a fairly good job of estimating the true reliability of the observed scores. There are also functions within the `<code>psych</code>` package that allow you to easily calculate coefficient alpha () among other reliability estimators</p>
</div>
</div>
</div>
</section>
<section id="test-retest-stability-estimator" class="level3">
<h3 class="anchored" data-anchor-id="test-retest-stability-estimator">Test-Retest Stability Estimator</h3>
<p>There measurement errors that exist outside of the measurement instrument itself. Transient errors represent fluctuations in observed scores over time. These fluctuations (e.g., weight over the course of a single day) add extraneous within-person variance that can mask true scores (i.e., expectation of observed scores). For example, if a researcher wants to investigate how individuals differ in processing speed, then variation within an individual’s scores across multiple testing sessions would be considered error since the goal of the study is to investigate between-person variation. Considering transient fluctuations as error depends on the research goal, so it is important for researchers to take care in considering which variance components should be considered error in their study. To estimate test-retest reliability, we can compute the pearson correlation coefficient between the measurement at time 1 (<span class="math inline">\(x_{T_{1}}\)</span>) and the second measurement at time 2 (<span class="math inline">\(x_{T_{2}}\)</span>).</p>
<p><span class="math display">\[
r_{xx',\text{TR}}= r_{x_{T_1}x_{T_2}}
\]</span></p>
</section>
</section>
<section id="unreliability-and-effect-size-bias" class="level2">
<h2 class="anchored" data-anchor-id="unreliability-and-effect-size-bias">Unreliability and Effect Size Bias</h2>
<section id="unreliability-on-correlation-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="unreliability-on-correlation-coefficients">Unreliability on correlation coefficients</h3>
<section id="background" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="background">Background</h4>
</section>
</section>
<section id="unreliability-error-on-standardized-mean-differences" class="level3">
<h3 class="anchored" data-anchor-id="unreliability-error-on-standardized-mean-differences">Unreliability error on standardized mean differences</h3>
<p><span class="citation" data-cites="haertel2006">(<a href="#ref-haertel2006" role="doc-biblioref">Haertel 2006</a>)</span></p>
<p><span class="citation" data-cites="schmidt2003">(<a href="#ref-schmidt2003" role="doc-biblioref">Schmidt, Le, and Ilies 2003</a>)</span></p>
<p><span class="citation" data-cites="gliem2003">(<a href="#ref-gliem2003" role="doc-biblioref">Gliem and Gliem 2003</a>)</span></p>
<p><span class="citation" data-cites="bobko2001">(<a href="#ref-bobko2001" role="doc-biblioref">Bobko, Roth, and Bobko 2001</a>)</span></p>
<p><span class="citation" data-cites="mendoza1987">(<a href="#ref-mendoza1987" role="doc-biblioref">Mendoza and Mumford 1987</a>)</span></p>
<p><span class="citation" data-cites="brennan2010">(<a href="#ref-brennan2010" role="doc-biblioref">Brennan 2010</a>)</span></p>
<p><span class="citation" data-cites="viswanathan2005">(<a href="#ref-viswanathan2005" role="doc-biblioref">Viswanathan 2005</a>)</span></p>
<p><span class="citation" data-cites="viswesvaran2014">(<a href="#ref-viswesvaran2014" role="doc-biblioref">Viswesvaran et al. 2014</a>)</span></p>
<p><span class="citation" data-cites="sijtsma2009">(<a href="#ref-sijtsma2009" role="doc-biblioref">Sijtsma 2009</a>)</span></p>
<p><span class="citation" data-cites="charles2005">(<a href="#ref-charles2005" role="doc-biblioref">Charles 2005</a>)</span></p>
<p><span class="citation" data-cites="spearman1904">(<a href="#ref-spearman1904" role="doc-biblioref">Spearman 1904</a>)</span></p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bobko2001" class="csl-entry" role="listitem">
Bobko, Philip, Philip Roth, and Christopher Bobko. 2001. <span>“Correcting the Effect Size of d for Range Restriction and Unreliability.”</span> <em>Organizational Research Methods - ORGAN RES METHODS</em> 4 (January): 46–61. <a href="https://doi.org/10.1177/109442810141003">https://doi.org/10.1177/109442810141003</a>.
</div>
<div id="ref-brennan2010" class="csl-entry" role="listitem">
Brennan, Robert L. 2010. <span>“Generalizability Theory and Classical Test Theory.”</span> <em>Applied Measurement in Education</em> 24 (1): 1–21. <a href="https://doi.org/10.1080/08957347.2011.532417">https://doi.org/10.1080/08957347.2011.532417</a>.
</div>
<div id="ref-charles2005" class="csl-entry" role="listitem">
Charles, Eric. 2005. <span>“The Correction for Attenuation Due to Measurement Error: Clarifying Concepts and Creating Confidence Sets.”</span> <em>Psychological Methods</em> 10 (July): 206–26. <a href="https://doi.org/10.1037/1082-989X.10.2.206">https://doi.org/10.1037/1082-989X.10.2.206</a>.
</div>
<div id="ref-gliem2003" class="csl-entry" role="listitem">
Gliem, Joseph A., and Rosemary R. Gliem. 2003. <span>“Calculating, Interpreting, And Reporting Cronbach<span>’</span>s Alpha Reliability Coefficient For Likert-Type Scales.”</span> <a href="https://scholarworks.iupui.edu/handle/1805/344">https://scholarworks.iupui.edu/handle/1805/344</a>.
</div>
<div id="ref-haertel2006" class="csl-entry" role="listitem">
Haertel, Edward H. 2006. <span>“3. Reliability.”</span> In, 4th ed.
</div>
<div id="ref-hunter1990a" class="csl-entry" role="listitem">
Hunter, John E., and Frank L. Schmidt. 1990. <em>Methods of meta-analysis: correcting error and bias in research findings</em>. Newbury Park: Sage Publications.
</div>
<div id="ref-mendoza1987" class="csl-entry" role="listitem">
Mendoza, Jorge L., and Michael Mumford. 1987. <span>“Corrections for Attenuation and Range Restriction on the Predictor.”</span> <em>Journal of Educational Statistics</em> 12 (3): 282–93. <a href="https://doi.org/10.3102/10769986012003282">https://doi.org/10.3102/10769986012003282</a>.
</div>
<div id="ref-schmidt2003" class="csl-entry" role="listitem">
Schmidt, Frank L., Huy Le, and Remus Ilies. 2003. <span>“Beyond Alpha: An Empirical Examination of the Effects of Different Sources of Measurement Error on Reliability Estimates for Measures of Individual-Differences Constructs.”</span> <em>Psychological Methods</em> 8: 206–24. <a href="https://doi.org/10.1037/1082-989X.8.2.206">https://doi.org/10.1037/1082-989X.8.2.206</a>.
</div>
<div id="ref-sijtsma2009" class="csl-entry" role="listitem">
Sijtsma, Klaas. 2009. <span>“On the Use, the Misuse, and the Very Limited Usefulness of&nbsp;Cronbach<span>’</span>s Alpha.”</span> <em>Psychometrika</em> 74 (1): 107–20. <a href="https://doi.org/10.1007/s11336-008-9101-0">https://doi.org/10.1007/s11336-008-9101-0</a>.
</div>
<div id="ref-spearman1904" class="csl-entry" role="listitem">
Spearman, C. 1904. <span>“The Proof and Measurement of Association Between Two Things.”</span> <em>International Journal of Epidemiology</em> 39 (5): 1137–50. <a href="https://doi.org/10.1093/ije/dyq191">https://doi.org/10.1093/ije/dyq191</a>.
</div>
<div id="ref-viswanathan2005" class="csl-entry" role="listitem">
Viswanathan, Madhu. 2005. <em>Measurement Error and Research Design</em>. SAGE.
</div>
<div id="ref-viswesvaran2014" class="csl-entry" role="listitem">
Viswesvaran, Chockalingam, Deniz S. Ones, Frank L. Schmidt, Huy Le, and In-Sue Oh. 2014. <span>“Measurement Error Obfuscates Scientific Knowledge: Path to Cumulative Knowledge Requires Corrections for Unreliability and Psychometric Meta-Analyses.”</span> <em>Industrial and Organizational Psychology</em> 7 (4): 507–18. <a href="https://doi.org/10.1017/S1754942600006799">https://doi.org/10.1017/S1754942600006799</a>.
</div>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>